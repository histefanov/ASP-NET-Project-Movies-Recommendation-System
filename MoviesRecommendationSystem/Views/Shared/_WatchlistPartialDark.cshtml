@using MoviesRecommendationSystem.Services.Watchlists.Models;

@inject SignInManager<User> SignInManager
@inject IWatchlistService WatchlistService

@{
    IEnumerable<WatchlistMovieServiceModel> watchlistMovies;
    int watchlistCount;
    bool userIsAuthenticated = User.Identity.IsAuthenticated;
    string userId;

    if (userIsAuthenticated)
    {
        userId = User.GetId();
        watchlistMovies = WatchlistService.GetMoviesByUser(userId);
        watchlistCount = watchlistMovies.Count();
    }
    else
    {
        userId = string.Empty;
        watchlistMovies = null;
        watchlistCount = 0;
    }
}

@if (userIsAuthenticated)
{
    <div class="dropdown show">
        <a href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <img width="40px" height="40px" src="~/img/watchlist-logo-white.png" alt="Watchlist" />
            <span class="badge bg-white text-black" id="watchlist-counter">@watchlistCount</span>
        </a>
        <div class="dropdown-menu dropdown-menu-right bg-dark" aria-labelledby="dropdownMenuLink">

            <div id="watchlist-dropdown">
                @foreach (var movie in watchlistMovies.Take(5))
                {
                    <a class="dropdown-item bg-dark text-white" asp-controller="Movies" asp-action="Details" asp-route-id="@movie.Id" asp-route-info="@movie.GetInfo()" id="@movie.Id">@movie.Title (@movie.ReleaseYear)</a>
                }
            </div>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item bg-dark text-white" asp-controller="Watchlists" asp-action="All" asp-route-userId="@userId">See all</a>
        </div>
    </div>
}